<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Process Data - Insight IQ</title>
    <!-- Links to your CSS and Google Fonts -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Consistent Header for Navigation -->
    <header class="main-header">
        <div class="container">
            <a href="{{ url_for('index') }}" class="logo">Insight IQ</a>
            <nav class="main-nav">
                <ul>
                    <li><a href="{{ url_for('upload_file') }}" class="nav-button">Upload Data</a></li>
                    <li><a href="{{ url_for('process_data') }}" class="nav-button active">Data Pre-processing</a></li>
                    <li><a href="{{ url_for('custom_chart') }}" class="nav-button">Custom Chart</a></li>
                    <li><a href="{{ url_for('ai_chart') }}" class="nav-button">AI Chart</a></li>
                    <li><a href="{{ url_for('summary_generator_page') }}" class="nav-button">Summary Generator</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="process-container">
            <h1>Data Pre-processing</h1>

            <!-- Section for displaying feedback messages (e.g., "Outliers removed") -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-message {{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Displays the current filename and provides a download link -->
            <div class="file-info">
                <strong>Current File:</strong> {{ current_file }} <br>
                <a href="{{ url_for('download_file', filename=current_file) }}" class="download-link">Download this version</a>
            </div>

            <!-- Section 1: Step-by-Step Processing with Dropdown -->
            <div class="processing-section">
                <h3>1. Apply Sequential Processing Steps</h3>
                <p>Apply these steps in order to clean and prepare your data for analysis.</p>
                <form method="POST" action="{{ url_for('process_data') }}" class="processing-form">
                    <select name="processing_step" id="processing_step" required>
                        <option value="" disabled selected>-- Choose a Processing Step --</option>
                        <option value="missing">Handle Missing Values</option>
                        <option value="cleaning">Clean Data (Remove Duplicates)</option>
                        <option value="outliers">Handle Outliers (IQR Method)</option>
                        <option value="transform">Transform Data (Placeholder)</option>
                        <option value="encode">Encode Categorical Data</option>
                    </select>
                    <button type="submit" class="submit-btn" style="width: auto; margin-top: 0;">Apply Step</button>
                </form>
            </div>

            <!-- Section 2: Feature Selection with Checkboxes -->
            <div class="processing-section">
                <h3>2. Feature Selection</h3>
                <p>Select any columns you wish to permanently remove from the dataset. This can be done at any time.</p>
                <form method="POST" action="{{ url_for('process_data') }}">
                    <input type="hidden" name="processing_step" value="feature_selection">
                    <div class="columns-grid">
                        {% for col in column_names %}
                            <label class="column-label">
                                <input type="checkbox" name="columns_to_drop" value="{{ col }}"> {{ col }}
                            </label>
                        {% endfor %}
                    </div>
                    <button type="submit" class="submit-btn btn-danger">Remove Selected Columns</button>
                </form>
            </div>


            <!-- Section 4: Data Preview Table -->
            <div class="data-preview">
                <h3>Data Preview (First 5 Rows)</h3>
                {{ data_preview|safe }}
            </div>
        </div>
    </main>

    <!-- Consistent Footer -->
    <footer class="main-footer">
        <p>&copy; 2024 Insight IQ. All Rights Reserved.</p>
    </footer>
</body>
</html>